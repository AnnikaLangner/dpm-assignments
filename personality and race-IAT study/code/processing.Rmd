---
title: "Examining the relationship between the big-5 personality facets and implicit racial attitudes"
subtitle: "Data processing"
author: "Annika Langner"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

```


# Dependencies

```{r}

library(tidyverse)
library(janitor) 
library(stringr)
library(openxlsx)
library(dplyr)
library(tidyr)

```

# Get data

```{r}

# demographics
data_demographics_raw <- read_csv("../data/raw/data_raw_demographics.csv") |>
janitor::clean_names()

# big-5 personality
data_bfi_raw <- read_csv("../data/raw/data_raw_bfi.csv") |>
  janitor::clean_names()

# implicit racial attitudes
data_iat_raw <- read_csv("../data/raw/data_raw_iat.csv") |>
  janitor::clean_names()

```

# Demographics

- Extract age and gender from the raw demographics data.

```{r}

data_demographics <- data_demographics_raw |>
  group_by(unique_id, variable) |>
  mutate(row_id = row_number()) |>
  pivot_wider(names_from = variable, values_from = response) |>
  mutate(across(c(age), as.numeric))|>
  rename(gender=sex)|>
  select(-row_id)

```

# Big Five

## Reversal of items

- Reverse score the negatively worded items: the extroversion scale items 2, 5 and 7, conscientiousness items 2, 4 5 and 9, neuroticism items 2, 5, and 7, agreeableness 1, 3, 6, and 8, and openness items 7 and 9.
```{r}

# Create new columns with reserved numbers - logical minimum and maximum scores (1 to 6)
## If the values in the variable bfi_xX are between 1 and 6, then the corresponding values in the new variable bfi_xX_rev will be computed as 7 - bfi_xX.
## If the values in bfi_xX do not fall within the range of 1 to 6, then the values in bfi_xX_rev will be NA.
data_bfi_rev <- data_bfi_raw |>
  mutate(bfi_e2_rev = ifelse(bfi_e2 >= 1 & bfi_e2 <= 6, 7 - bfi_e2, NA),
         bfi_e5_rev = ifelse(bfi_e5 >= 1 & bfi_e5 <= 6, 7 - bfi_e5, NA),
         bfi_e7_rev = ifelse(bfi_e7 >= 1 & bfi_e7 <= 6, 7 - bfi_e7, NA),
         bfi_c2_rev = ifelse(bfi_c2 >= 1 & bfi_c2 <= 6, 7 - bfi_c2, NA),
         bfi_c4_rev = ifelse(bfi_c4 >= 1 & bfi_c4 <= 6, 7 - bfi_c4, NA),
         bfi_c5_rev = ifelse(bfi_c5 >= 1 & bfi_c5 <= 6, 7 - bfi_c5, NA),
         bfi_c9_rev = ifelse(bfi_c9 >= 1 & bfi_c9 <= 6, 7 - bfi_c9, NA),
         bfi_n2_rev = ifelse(bfi_n2 >= 1 & bfi_n2 <= 6, 7 - bfi_n2, NA),
         bfi_n5_rev = ifelse(bfi_n5 >= 1 & bfi_n5 <= 6, 7 - bfi_n5, NA),
         bfi_n7_rev = ifelse(bfi_n7 >= 1 & bfi_n7 <= 6, 7 - bfi_n7, NA),
         bfi_a1_rev = ifelse(bfi_a1 >= 1 & bfi_a1 <= 6, 7 - bfi_a1, NA),
         bfi_a3_rev = ifelse(bfi_a3 >= 1 & bfi_a3 <= 6, 7 - bfi_a3, NA),
         bfi_a6_rev = ifelse(bfi_a6 >= 1 & bfi_a6 <= 6, 7 - bfi_a6, NA),
         bfi_a8_rev = ifelse(bfi_a8 >= 1 & bfi_a8 <= 6, 7 - bfi_a8, NA),
         bfi_o7_rev = ifelse(bfi_o7 >= 1 & bfi_o7 <= 6, 7 - bfi_o7, NA),
         bfi_o9_rev = ifelse(bfi_o9 >= 1 & bfi_o9 <= 6, 7 - bfi_o9, NA))


#Create a new data frame that excludes the old item columns that have been reversed (without_onrc= without original not reversed columns)
data_bfi_rev_without_onrc<-data_bfi_rev|>
  select(-bfi_e2, -bfi_e5, -bfi_e7,-bfi_c2, -bfi_c4, -bfi_c5, -bfi_c9,-bfi_n2, -bfi_n5, -bfi_n7,-bfi_a1, -bfi_a3, -bfi_a6, -bfi_a8,-bfi_o7, -bfi_o9)

```

### Sanity check: correlation table among the items

  - Include a sanity check that assesses whether these list of item reversals, and your implementation of them, is likely to be correct: For each subscale, create a correlation table among the items (after reversals) and check that all correlations are positive. IN general, negative correlations among items are one indication that information about item reversals, or their implementation, is not correct.

```{r}

#extroversion
cor_bfi_e<-data_bfi_rev_without_onrc|>select(starts_with("bfi_e"))|>
  cor(use = "complete.obs", method = "pearson")
#conscientiousness
cor_bfi_c<-data_bfi_rev_without_onrc|>select(starts_with("bfi_c"))|>
  cor(use = "complete.obs", method = "pearson")
#neuroticism
cor_bfi_n<-data_bfi_rev_without_onrc|>select(starts_with("bfi_n"))|>
  cor(use = "complete.obs", method = "pearson")
#agreeableness
cor_bfi_a<-data_bfi_rev_without_onrc|>select(starts_with("bfi_a"))|>
  cor(use = "complete.obs", method = "pearson")
#openness
cor_bfi_o<-data_bfi_rev_without_onrc|>select(starts_with("bfi_o"))|>
  cor(use = "complete.obs", method = "pearson")

#Print if negative correlations exist
negative_values_e_exist <- any(cor_bfi_e < 0)
negative_values_c_exist <- any(cor_bfi_c < 0)
negative_values_n_exist <- any(cor_bfi_n < 0)
negative_values_a_exist <- any(cor_bfi_a < 0)
negative_values_o_exist <- any(cor_bfi_o < 0)

if (negative_values_e_exist | negative_values_c_exist| negative_values_n_exist| negative_values_a_exist| negative_values_o_exist) {
  print("In at least one subscale, there is at least one negative correlation.")
} else {
  print("There are no negative correlations in any of the five subscales.")
}

#Print the results for every subscale
cat("Results:\n","extroversion:", ifelse(negative_values_e_exist, "Negative correlation (s)", "No negative correlation"), "\n",
    "conscientiousness:", ifelse(negative_values_c_exist, "Negative correlation (s)", "No negative correlation"), "\n",
    "neuroticism:", ifelse(negative_values_n_exist, "Negative correlation (s)", "No negative correlation"), "\n",
    "agreeableness:", ifelse(negative_values_a_exist, "Negative correlation (s)", "No negative correlation"), "\n",
    "openness:", ifelse(negative_values_o_exist, "Negative correlation (s)", "No negative correlation"), "\n")

```

### Exclusion variable: bfi_logical_scores

- Check that the item level data does not violate the logical minimum and maximum scores (1 to 6). Create an exclusion variable and set participants with impossible data to "exclude". 
```{r}

#Create a new exclusion data frame:
##The condition in the code is checking, row-wise, whether the sum of logical conditions for values in columns starting with "bfi_" is greater than 0. The specific logical conditions are that values should be less than 1 or greater than 6. If this sum is greater than 0 for a given row, the corresponding value in the new column exclude_bfi_logicalscores is set to "exclude".
data_bfi_logical_scores <- data_bfi_raw|>
  rowwise()|>
  mutate(exclude_bfi_logical_scores = ifelse(sum(c_across(starts_with("bfi_")) < 1 | c_across(starts_with("bfi_")) > 6, na.rm = TRUE) > 0, "exclude", "include"))|>
  select(unique_id,exclude_bfi_logical_scores)


# Print the results
result_bfi_logical_scores <- table(data_bfi_logical_scores$exclude_bfi_logical_scores)
cat("The distribution for BFI logical scores:\n exclude->", result_bfi_logical_scores["exclude"], "and include->", result_bfi_logical_scores["include"])

```
 
### Exclusion variable: bfi_completeness 
 
 - Check that all participants have complete data on the BFI scales they completed. Create an exclusion variable and set participants with incomplete data to "exclude".
 
```{r}

#Create a new exclusion data frame
##For each subset of columns (e.g., "bfi_e"), it checks whether there are any non-zero values (rowSums(...) > 0) and whether there are any missing values (rowSums(is.na(...)) > 0). If both conditions are true for a row, it marks the row with "exclude". 

data_bfi_completeness <- data_bfi_raw |>
  mutate(exclude_bfi_completeness = ifelse(
      rowSums(select(data_bfi_raw, starts_with("bfi_e")), na.rm = TRUE) > 0 & rowSums(is.na(select(data_bfi_raw, starts_with("bfi_e")))) > 0 |
      rowSums(select(data_bfi_raw, starts_with("bfi_c")), na.rm = TRUE) > 0 & rowSums(is.na(select(data_bfi_raw, starts_with("bfi_c")))) > 0 |
      rowSums(select(data_bfi_raw, starts_with("bfi_n")), na.rm = TRUE) > 0 & rowSums(is.na(select(data_bfi_raw, starts_with("bfi_n")))) > 0 |
      rowSums(select(data_bfi_raw, starts_with("bfi_a")), na.rm = TRUE) > 0 & rowSums(is.na(select(data_bfi_raw, starts_with("bfi_a")))) > 0 |
      rowSums(select(data_bfi_raw, starts_with("bfi_o")), na.rm = TRUE) > 0 & rowSums(is.na(select(data_bfi_raw, starts_with("bfi_o")))) > 0,
      "exclude",
      "include"))|>
  select(unique_id,exclude_bfi_completeness)

# Print the results
result_bfi_compl <- table(data_bfi_completeness$exclude_bfi_completeness)
cat("The distribution for BFI completeness:\n exclude->", result_bfi_compl["exclude"], "and include->", result_bfi_compl["include"])

```

## Mean score BFI scale

- Mean-score the subscales of the BFI scale. Each participant only got either 2 or 3 subscales.
```{r}

#Exclude the rows 
data_bfi_rev_without_onrc_ex_compl<-data_bfi_rev_without_onrc|>
  full_join(data_bfi_completeness, by = "unique_id")|>
  filter(exclude_bfi_completeness=="include")

#Create a new column with the mean values for each subscale
data_bfi_meanscore <- data_bfi_rev_without_onrc_ex_compl |>
  mutate(bfi_e_mean = ifelse(rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_e")), na.rm = TRUE) > 0,
                             rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_e")), na.rm = TRUE), NA),
         bfi_c_mean = ifelse(rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_c")), na.rm = TRUE) > 0,
                             rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_c")), na.rm = TRUE), NA),
         bfi_n_mean = ifelse(rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_n")), na.rm = TRUE) > 0,
                             rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_n")), na.rm = TRUE), NA),
         bfi_a_mean = ifelse(rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_a")), na.rm = TRUE) > 0,
                             rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_a")), na.rm = TRUE), NA),
         bfi_o_mean = ifelse(rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_o")), na.rm = TRUE) > 0,
                             rowSums(select(data_bfi_rev_without_onrc_ex_compl, starts_with("bfi_o")), na.rm = TRUE), NA))|>
  select(unique_id,bfi_e_mean,bfi_c_mean,bfi_n_mean,bfi_a_mean,bfi_o_mean)


```

### Sanity check: mean score in the range 

- Check that the mean scores do not violate the min and max possible score (i.e., first determine this min and max score), and revise your scoring code if it does. 

```{r}

#Max score = number of columns *6
maxscore_bfi_e <- data_bfi_raw |>
  select(starts_with("bfi_e")) |>
  ncol()*6
maxscore_bfi_c <- data_bfi_raw |>
  select(starts_with("bfi_c")) |>
  ncol()*6
maxscore_bfi_n <- data_bfi_raw |>
  select(starts_with("bfi_n")) |>
  ncol()*6
maxscore_bfi_a <- data_bfi_raw |>
  select(starts_with("bfi_a")) |>
  ncol()*6
maxscore_bfi_o <- data_bfi_raw |>
  select(starts_with("bfi_o")) |>
  ncol()*6

#Min score = number of columns *1
minscore_bfi_e <- data_bfi_raw |>
  select(starts_with("bfi_e")) |>
  ncol()*1
minscore_bfi_c <- data_bfi_raw |>
  select(starts_with("bfi_c")) |>
  ncol()*1
minscore_bfi_n <- data_bfi_raw |>
  select(starts_with("bfi_n")) |>
  ncol()*1
minscore_bfi_a <- data_bfi_raw |>
  select(starts_with("bfi_a")) |>
  ncol()*1
minscore_bfi_o <- data_bfi_raw |>
  select(starts_with("bfi_o")) |>
  ncol()*1

result_range_e <- data_bfi_meanscore |>
  filter(bfi_e_mean > maxscore_bfi_e | bfi_e_mean < minscore_bfi_e)
result_range_c <- data_bfi_meanscore |>
  filter(bfi_c_mean > maxscore_bfi_c | bfi_c_mean < minscore_bfi_c)
result_range_n <- data_bfi_meanscore |>
  filter(bfi_n_mean > maxscore_bfi_n | bfi_n_mean < minscore_bfi_n)
result_range_a <- data_bfi_meanscore |>
  filter(bfi_a_mean > maxscore_bfi_a | bfi_a_mean < minscore_bfi_a)
result_range_o <- data_bfi_meanscore |>
  filter(bfi_o_mean > maxscore_bfi_o | bfi_o_mean < minscore_bfi_o)

#Print the results for every subscale
if (nrow(result_range_e) == 0) {
  print("The mean scores extroversion do not violate the min and max possible score")
} else {
  print("Attention: The mean scores extroversion do  violate the min and max possible score")
}

if (nrow(result_range_c) == 0) {
  print("The mean scores conscientiousness do not violate the min and max possible score")
} else {
  print("Attention: The mean scores conscientiousness do  violate the min and max possible score")
}

if (nrow(result_range_n) == 0) {
  print("The mean scores neuroticism do not violate the min and max possible score")
} else {
  print("Attention: The mean scores neuroticism do  violate the min and max possible score")
}

if (nrow(result_range_a) == 0) {
  print("The mean scores agreeablenessn do not violate the min and max possible score")
} else {
  print("Attention: The mean scores agreeableness do  violate the min and max possible score")
}

if (nrow(result_range_o) == 0) {
  print("The mean scores openness do not violate the min and max possible score")
} else {
  print("Attention: The mean scores openness do  violate the min and max possible score")
}

```

#  Implicit racial attitudes

## IAT scores
- Score the trial-level IAT data using the Greenwald "D" score: Calculate a mean RT ("mean1") for blocks 3 and 6 (one score using trials from both blocks), a mean RT ("mean2") for blocks 4 and 7 (one score using trials from both blocks), and the SD of RTs in blocks 3, 4, 6 and 7 ("SD"). To calculate D: D = (mean2 - mean1)/SD. Blocks 1, 2, and 5 are practice blocks and must be discarded. 

```{r}

#data frame preparation: rename column names, filter test trials (block1,2,5), convert reaction time and unique_id into numeric and delete first row
data_iat<-data_iat_raw|>
  rename(unique_id=participant,
         block_number=block,
         block_required_responses=x3,
         trial_responses=trial,
         trial_accuracy=x5,
         trial_reaction_time_in_ms=x6
  )|>
  slice(-1)|>
  filter(block_number!="1",block_number!="2",block_number!="5")
data_iat$ trial_reaction_time_in_ms <- as.numeric(data_iat$trial_reaction_time_in_ms)
data_iat$unique_id <- as.numeric(data_iat$unique_id)

#mean1
data_iat_mean1 <- data_iat |> 
  filter(block_number == 3 | block_number == 6) |>
  group_by(unique_id) |> 
  summarize(iat_mean1 = mean(trial_reaction_time_in_ms, na.rm = TRUE))
#mean2
data_iat_mean2 <- data_iat |> 
  filter(block_number == 4 | block_number == 7) |>
  group_by(unique_id) |> 
  summarize(iat_mean2 = mean(trial_reaction_time_in_ms, na.rm = TRUE))
#SD
data_iat_SD <- data_iat |> 
  filter(block_number == 3 | block_number == 4|block_number == 6 | block_number == 7) |>
  group_by(unique_id) |> 
  summarize(iat_SD = sd(trial_reaction_time_in_ms, na.rm = TRUE))
#D
data_iat_D <-data_iat_mean1  |>
  full_join(data_iat_mean2, by = "unique_id") |> 
  full_join(data_iat_SD, by = "unique_id")|>
  mutate(iat_D=(iat_mean2-iat_mean1)/iat_SD)

```

### Sanity check: D scores in the range -2 to +2

  - Include a sanity check: check that all D scores are in the range -2 to +2. If not, revise your implementation of the scoring code.

```{r}
all_values_within_range <- all(data_iat_D$iat_D >= -2 & data_iat_D$iat_D <= 2)
cat("Results:\n",ifelse(all_values_within_range, "All scores are in the range -2 to +2", "All scores are not in the range -2 to +2"))

```

### Exclusion variable: iat_completeness 

- Create an exclusion variable and set participants with incomplete trial level IAT data to "exclude". Specifically, IAT should have 120 trials on the critical test blocks (i.e., blocks 3, 4, 6 and 7).  Trials on the other (practice) blocks can be discarded.

```{r}

data_iat_completeness<-data_iat|>
  group_by(unique_id) |>
  count() |>
  ungroup() |>
  mutate(exclude_iat_completeness = ifelse(n == 120, "include", "exclude")) |>
  select(-n)

# Print the results
result_iat_compl <- table(data_iat_completeness$exclude_iat_completeness)
cat("The distribution for IAT completeness:\n exclude->", result_iat_compl["exclude"], "and include->", result_iat_compl["include"])

```

### Exclusion variable: iat_performance 

- Create an exclusion variable for IAT performance: set participants with >10% of the participants trials are < 300ms, or if their accuracy is < than 75%. Only use trials from the critical test blocks when computing these (i.e., blocks 3, 4, 6 and 7).

```{r}

data_iat_performance <- data_iat |> 
  mutate(latency_prob = if_else(trial_reaction_time_in_ms < 300, TRUE, FALSE),
         accurcay_prob = if_else(trial_accuracy =="correct", TRUE, FALSE)) |>
  group_by(unique_id) |> 
  summarize(proportion_iat_latency = mean(latency_prob),
            proportion_iat_accurcay = mean(accurcay_prob))|>
  mutate(exclude_iat_performance = ifelse(proportion_iat_latency > 0.10|proportion_iat_accurcay<0.75, "exclude", "include"))|>
  select(-proportion_iat_latency,-proportion_iat_accurcay)

# Print the results
result_iat_perf <- table(data_iat_performance$exclude_iat_performance)
cat("The distribution for IAT performance:\n exclude->", result_iat_perf["exclude"], "and include->", result_iat_perf["include"])

```

# Combine

- Combine the demographics, BFI, and IAT data into one data frame. This data frame should be one-row-one-participant. Both the mean scored and item level BFI data should be present in the dataset.

```{r}

data_processed_temp <- data_demographics 

```

# Define master exclusions

- Create a master exclude variable from the individual exclude variables.

```{r}

data_processed<-data_processed_temp

```

# Write to disk

- Save the processed data to the data/processed/ folder as "data_processed.csv". 

```{r}

```

# Codebooks 

I have created two codebooks, one for the Excel sheet and one for the R file. Both codebooks are populated in the R code, ensuring that the codebook is always up-to-date. If new variables are introduced, they are added directly. The codebook is then overwritten each time, and one must be careful not to inadvertently overwrite important information in the Excel sheet which have been manually added.

## Codebook for excel sheet data_processed.csv

- Create a codebook for the processed data file that explains what each variable represents.

```{r}
#Create and combine variables for the Codebook
variable_codebook_E_dp<- names(data_processed)

variables_to_remove_E <- c("bfi_e1","bfi_e3","bfi_e4","bfi_e6","bfi_e8","bfi_e2_rev","bfi_e7_rev","bfi_e5_rev",
                           "bfi_c1","bfi_c3","bfi_c6","bfi_c7","bfi_c8","bfi_c","bfi_c2_rev","bfi_c4_rev","bfi_c5_rev","bfi_c9_rev",
                           "bfi_n1","bfi_n3","bfi_n4","bfi_n6","bfi_n8","bfi_n2_rev","bfi_n5_rev","bfi_n7_rev",
                           "bfi_a2","bfi_a4","bfi_a5","bfi_a7","bfi_a9","bfi_a1_rev","bfi_a3_rev","bfi_a6_rev","bfi_a8_rev",
                           "bfi_o1","bfi_o10","bfi_o2","bfi_o3","bfi_o4","bfi_o5","bfi_o6","bfi_o8","bfi_o7_rev","bfi_o9_rev")
variable_to_add_E<-c("bfi_e1,...,bfi_e9","bfi_c1,...,bfi_c9","bfi_n1,...,bfi_n9","bfi_a1,...,bfi_a9","bfi_o1,...,bfi_o9",
                     "bfi_e1_rev,...,bfi_e9_rev","bfi_c1_rev,...,bfi_c9_rev","bfi_n1_rev,...,bfi_n9_rev","bfi_a1_rev,...,bfi_a9_rev","bfi_o1_rev,...,bfi_o9_rev")

variable_codebook_E_dp_vtr <- variable_codebook_E_dp[!variable_codebook_E_dp %in% variables_to_remove_E] # Remove variables_to_remove_E from variable_codebook_E_dp
sorted_variable_codebook_E_dp_vtr <- variable_codebook_E_dp_vtr[order(variable_codebook_E_dp_vtr!= "Unique ID", variable_codebook_E_dp_vtr, na.last = FALSE)] #sort the variabkle 
variable_codebook_E <- c(sorted_variable_codebook_E_dp_vtr, variable_to_add_E) #Add variable_to_add_E to sorted_variable_codebook_E_dp_vtr

#Create codebook
codebook_E <- data.frame(
  Variable=variable_codebook_E
)|>
  mutate(explanation = case_when(Variable == "bfi_e_mean" ~ "",
                                 Variable == "bfi_c_mean" ~ "",
                                 Variable == "bfi_n_mean" ~ "",
                                 Variable == "bfi_a_mean" ~ "",
                                 Variable == "bfi_o_mean" ~ "",
                                 Variable == "exclude_bfi_completeness" ~ "",
                                 Variable == "exclude_bfi_logical_scores" ~ "",
                                 Variable == "exclude_iat_completeness" ~ "",
                                 Variable == "exclude_iat_performance" ~ "",
                                 Variable == "exclude_participant" ~ "",
                                 Variable == "iat_D" ~ "",
                                 Variable == "iat_SD" ~ "",
                                 Variable == "iat_mean1" ~ "",
                                 Variable == "iat_mean2" ~ "",
                                 Variable == "unique_id" ~   "Participant identification number",
                                 Variable == "age" ~   "Participant age",
                                 Variable == "gender" ~   "Participant gender",
                                 Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "Different reversed items form the subscale extroversion",
                                 Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "Different reversed items form the subscale conscientiousness",
                                 Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "Different reversed items form the subscale neuroticism",
                                 Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "Different reversed items form the subscale agreeableness",
                                 Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "Different reversed items form the subscale openness",
                                 Variable == "bfi_e1,...,bfi_e9" ~   "Different  items form the subscale extroversion",
                                 Variable == "bfi_c1,...,bfi_c9" ~   "Different items form the subscale conscientiousness",
                                 Variable == "bfi_n1,...,bfi_n9" ~   "Different items form the subscale neuroticism",
                                 Variable == "bfi_a1,...,bfi_a9" ~   "Different items form the subscale agreeableness",
                                 Variable == "bfi_o1,...,bfi_o9" ~   "Different items form the subscale openness",
                                 TRUE ~ NA))|>
  
  mutate(items_used_and_calculation = case_when(Variable == "bfi_e_mean" ~ "",
                                                Variable == "bfi_c_mean" ~ "",
                                                Variable == "bfi_n_mean" ~ "",
                                                Variable == "bfi_a_mean" ~ "",
                                                Variable == "bfi_o_mean" ~ "",
                                                Variable == "exclude_bfi_completeness" ~ "",
                                                Variable == "exclude_bfi_logical_scores" ~ "",
                                                Variable == "exclude_iat_completeness" ~ "",
                                                Variable == "exclude_iat_performance" ~ "",
                                                Variable == "exclude_participant" ~ "",
                                                Variable == "iat_D" ~ "",
                                                Variable == "iat_SD" ~ "",
                                                Variable == "iat_mean1" ~ "",
                                                Variable == "iat_mean2" ~ "",
                                                Variable == "unique_id" ~   "",
                                                Variable == "age" ~   "",
                                                Variable == "gender" ~   "",
                                                Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "",
                                                Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "",
                                                Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "",
                                                Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "",
                                                Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "",
                                                Variable == "bfi_e1,...,bfi_e9" ~   "",
                                                Variable == "bfi_c1,...,bfi_c9" ~   "",
                                                Variable == "bfi_n1,...,bfi_n9" ~   "",
                                                Variable == "bfi_a1,...,bfi_a9" ~   "",
                                                Variable == "bfi_o1,...,bfi_o9" ~   "",
                                                TRUE ~ NA))|>
  mutate(Range=case_when(Variable == "bfi_e_mean" ~ "",
                         Variable == "bfi_c_mean" ~ "",
                         Variable == "bfi_n_mean" ~ "",
                         Variable == "bfi_a_mean" ~ "",
                         Variable == "bfi_o_mean" ~ "",
                         Variable == "exclude_bfi_completeness" ~ "",
                         Variable == "exclude_bfi_logical_scores" ~ "",
                         Variable == "exclude_iat_completeness" ~ "",
                         Variable == "exclude_iat_performance" ~ "",
                         Variable == "exclude_participant" ~ "",
                         Variable == "iat_D" ~ "",
                         Variable == "iat_SD" ~ "",
                         Variable == "iat_mean1" ~ "",
                         Variable == "iat_mean2" ~ "",
                         Variable == "unique_id" ~   "",
                         Variable == "age" ~   "",
                         Variable == "gender" ~   "",
                         Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "",
                         Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "",
                         Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "",
                         Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "",
                         Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "",
                         Variable == "bfi_e1,...,bfi_e9" ~   "",
                         Variable == "bfi_c1,...,bfi_c9" ~   "",
                         Variable == "bfi_n1,...,bfi_n9" ~   "",
                         Variable == "bfi_a1,...,bfi_a9" ~   "",
                         Variable == "bfi_o1,...,bfi_o9" ~   "",
                         TRUE ~ NA))|>
  
  mutate(Study = case_when(Variable == "bfi_e_mean" ~ "",
                           Variable == "bfi_c_mean" ~ "",
                           Variable == "bfi_n_mean" ~ "",
                           Variable == "bfi_a_mean" ~ "",
                           Variable == "bfi_o_mean" ~ "",
                           Variable == "exclude_bfi_completeness" ~ "",
                           Variable == "exclude_bfi_logical_scores" ~ "",
                           Variable == "exclude_iat_completeness" ~ "",
                           Variable == "exclude_iat_performance" ~ "",
                           Variable == "exclude_participant" ~ "",
                           Variable == "iat_D" ~ "",
                           Variable == "iat_SD" ~ "",
                           Variable == "iat_mean1" ~ "",
                           Variable == "iat_mean2" ~ "",
                           Variable == "unique_id" ~   "",
                           Variable == "age" ~   "",
                           Variable == "gender" ~   "",
                           Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "",
                           Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "",
                           Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "",
                           Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "",
                           Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "",
                           Variable == "bfi_e1,...,bfi_e9" ~   "",
                           Variable == "bfi_c1,...,bfi_c9" ~   "",
                           Variable == "bfi_n1,...,bfi_n9" ~   "",
                           Variable == "bfi_a1,...,bfi_a9" ~   "",
                           Variable == "bfi_o1,...,bfi_o9" ~   "",
                           TRUE ~ NA))


#write.xlsx(codebook_E, file = "../data/processed/data_processed_codebook.xlsx")

# Create an Excel workbook
wb_Codebook_E <- createWorkbook()

# Add a worksheet named "Codebook" to the workbook
addWorksheet(wb_Codebook_E, "Codebook")

# Write the data frame 'codebook_E' to the "Codebook" worksheet
writeData(wb_Codebook_E, "Codebook", codebook_E)

# Adjust the column widths of the "Codebook" worksheet to fit the content
setColWidths(wb_Codebook_E, "Codebook", cols = 1:ncol(codebook_E), widths = "auto")

# Save to disk
saveWorkbook(wb_Codebook_E, file = "../data/processed/data_processed_codebook.xlsx", overwrite = TRUE)

```

## Codebook for this R file processing.Rmd

```{r}

variable_to_add_R<-c("codebook_R") # Variable contains "codebook_R"
variable_codebook_R_ls<-ls() # Variable from this R file

# Combine the variables: variable_codebook_R_ls, variable_to_add_R, variable_codebook_E (contains all variable from the codebook for the excel sheet)
variable_codebook_R <- c(variable_codebook_R_ls, variable_to_add_R, variable_codebook_E) 

codebook_R <- data.frame(
  Variable=variable_codebook_R )|>
  mutate(explanation = case_when(Variable == "data_bfi_raw" ~ "Data Frame: containing raw data from big five inventory table",
                                 Variable == "data_demographics_raw" ~ "Data Frame containing raw demographic data",
                                 Variable == "data_iat_raw" ~ "Data Frame: containing raw data from IAT",
                                 Variable == "data_demographics" ~ "Data Frame containing raw demographic data",
                                 Variable == "data_iat" ~ "",
                                 Variable == "data_bfi" ~ "",
                                 Variable == "data_bfi_completeness" ~ "",
                                 Variable == "ddata_iat_completeness" ~ "",
                                 Variable == "data_bfi_logical_scores" ~ "",
                                 Variable == "data_bfi_meanscore" ~ "",
                                 Variable == "data_bfi_rev" ~ "",
                                 Variable == "data_bfi_rev_without_onrc" ~ "",
                                 Variable == "data_bfi_rev_without_onrc_ex_compl" ~ "",
                                 Variable == "data_demographics_raw" ~ "",
                                 Variable == "data_iat_D" ~ "",
                                 Variable == "data_iat_mean1" ~ "",
                                 Variable == "data_iat_mean2" ~ "",
                                 Variable == "data_iat_performance" ~ "",
                                 Variable == "data_iat_SD" ~ "",
                                 Variable == "data_processed" ~ "Data Frame: All information for analysis",
                                 Variable == "data_processed_temp" ~ "All information for analysis without the master exclusion column and the three demographic exclusions",
                                 Variable == "maxscore_bfi_e" ~ "",
                                 Variable == "maxscore_bfi_c" ~ "",
                                 Variable == "maxscore_bfi_n" ~ "",
                                 Variable == "maxscore_bfi_a" ~ "",
                                 Variable == "maxscore_bfi_o" ~ "",
                                 Variable == "minscore_bfi_e" ~ "",
                                 Variable == "minscore_bfi_c" ~ "",
                                 Variable == "minscore_bfi_n" ~ "",
                                 Variable == "minscore_bfi_a" ~ "",
                                 Variable == "minscore_bfi_o" ~ "",
                                 Variable == "cor_bfi_e" ~ "",
                                 Variable == "cor_bfi_c" ~ "",
                                 Variable == "cor_bfi_n" ~ "",
                                 Variable == "cor_bfi_a" ~ "",
                                 Variable == "cor_bfi_o" ~ "",
                                 Variable == "negative_values_e_exist" ~ "",
                                 Variable == "negative_values_c_exist" ~ "",
                                 Variable == "negative_values_n_exist" ~ "",
                                 Variable == "negative_values_a_exist" ~ "",
                                 Variable == "negative_values_o_exist" ~ "",
                                 Variable == "result_range_e" ~ "",
                                 Variable == "result_range_c" ~ "",
                                 Variable == "result_range_n" ~ "",
                                 Variable == "result_range_a" ~ "",
                                 Variable == "result_range_o" ~ "",
                                 Variable == "result_bfi_compl" ~ "",
                                 Variable == "result_bfi_logical_scores" ~ "",
                                 Variable == "result_iat_compl" ~ "",
                                 Variable == "result_iat_perf" ~ "",
                                 Variable == "result_master_exclusion" ~ "",
                                 Variable == "codebook_E" ~ "Codebook for the Excel sheet",
                                 Variable == "codebook_R" ~ "Codebook for the R sheet",
                                 Variable == "sorted_variable_codebook_E_dp_vtr" ~ "",
                                 Variable == "variable_codebook_E" ~ "All variables for the Codebbok_E",
                                 Variable == "variable_codebook_R" ~ "All variables for the Codebbok_R",
                                 Variable == "variable_codebook_E_dp" ~ "Variable from data_processed",
                                 Variable == "variable_codebook_E_dp_vtr" ~ "Variable_codebook_E_dp without variables_to_remove_E",
                                 Variable == "variable_to_add_E" ~ "",
                                 Variable == "variable_to_add_R" ~ "Variable contains codebook_R",
                                 Variable == "variables_to_remove_R" ~ "",
                                 Variable == "variable_codebook_R_ls" ~ "Variable from this R file",
                                 Variable == "bfi_e_mean" ~ "",
                                 Variable == "bfi_c_mean" ~ "",
                                 Variable == "bfi_n_mean" ~ "",
                                 Variable == "bfi_a_mean" ~ "",
                                 Variable == "bfi_o_mean" ~ "",
                                 Variable == "exclude_bfi_completeness" ~ "",
                                 Variable == "exclude_bfi_logical_scores" ~ "",
                                 Variable == "exclude_iat_completeness" ~ "",
                                 Variable == "exclude_iat_performance" ~ "",
                                 Variable == "exclude_participant" ~ "",
                                 Variable == "iat_D" ~ "",
                                 Variable == "iat_SD" ~ "",
                                 Variable == "iat_mean1" ~ "",
                                 Variable == "iat_mean2" ~ "",
                                 Variable == "unique_id" ~   "Participant identification number",
                                 Variable == "age" ~   "Participant age",
                                 Variable == "gender" ~   "Participant gender",
                                 Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "Different reversed items form the subscale extroversion",
                                 Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "Different reversed items form the subscale conscientiousness",
                                 Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "Different reversed items form the subscale neuroticism",
                                 Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "Different reversed items form the subscale agreeableness",
                                 Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "Different reversed items form the subscale openness",
                                 Variable == "bfi_e1,...,bfi_e9" ~   "Different  items form the subscale extroversion",
                                 Variable == "bfi_c1,...,bfi_c9" ~   "Different items form the subscale conscientiousness",
                                 Variable == "bfi_n1,...,bfi_n9" ~   "Different items form the subscale neuroticism",
                                 Variable == "bfi_a1,...,bfi_a9" ~   "Different items form the subscale agreeableness",
                                 Variable == "bfi_o1,...,bfi_o9" ~   "Different items form the subscale openness",
                                 TRUE ~ NA))|>
  mutate(based_on = case_when(Variable == "data_bfi_raw" ~ "",
                              Variable == "data_demographics_raw" ~ "",
                              Variable == "data_iat_raw" ~ "",
                              Variable == "data_demographics" ~ "data_demographics_raw",
                              Variable == "data_iat" ~ "",
                              Variable == "data_bfi" ~ "",
                              Variable == "data_bfi_completeness" ~ "",
                              Variable == "ddata_iat_completeness" ~ "",
                              Variable == "data_bfi_logical_scores" ~ "",
                              Variable == "data_bfi_meanscore" ~ "",
                              Variable == "data_bfi_rev" ~ "",
                              Variable == "data_bfi_rev_without_onrc" ~ "",
                              Variable == "data_bfi_rev_without_onrc_ex_compl" ~ "",
                              Variable == "data_demographics_raw" ~ "",
                              Variable == "data_iat_D" ~ "",
                              Variable == "data_iat_mean1" ~ "",
                              Variable == "data_iat_mean2" ~ "",
                              Variable == "data_iat_performance" ~ "",
                              Variable == "data_iat_SD" ~ "",
                              Variable == "data_processed" ~ "",
                              Variable == "data_processed_temp" ~ "data_processed",
                              Variable == "maxscore_bfi_e" ~ "",
                              Variable == "maxscore_bfi_c" ~ "",
                              Variable == "maxscore_bfi_n" ~ "",
                              Variable == "maxscore_bfi_a" ~ "",
                              Variable == "maxscore_bfi_o" ~ "",
                              Variable == "minscore_bfi_e" ~ "",
                              Variable == "minscore_bfi_c" ~ "",
                              Variable == "minscore_bfi_n" ~ "",
                              Variable == "minscore_bfi_a" ~ "",
                              Variable == "minscore_bfi_o" ~ "",
                              Variable == "cor_bfi_e" ~ "",
                              Variable == "cor_bfi_c" ~ "",
                              Variable == "cor_bfi_n" ~ "",
                              Variable == "cor_bfi_a" ~ "",
                              Variable == "cor_bfi_o" ~ "",
                              Variable == "negative_values_e_exist" ~ "",
                              Variable == "negative_values_c_exist" ~ "",
                              Variable == "negative_values_n_exist" ~ "",
                              Variable == "negative_values_a_exist" ~ "",
                              Variable == "negative_values_o_exist" ~ "",
                              Variable == "result_range_e" ~ "",
                              Variable == "result_range_c" ~ "",
                              Variable == "result_range_n" ~ "",
                              Variable == "result_range_a" ~ "",
                              Variable == "result_range_o" ~ "",
                              Variable == "result_bfi_compl" ~ "",
                              Variable == "result_bfi_logical_scores" ~ "",
                              Variable == "result_iat_compl" ~ "",
                              Variable == "result_iat_perf" ~ "",
                              Variable == "result_master_exclusion" ~ "",
                              Variable == "codebook_E" ~ "",
                              Variable == "codebook_R" ~ "",
                              Variable == "sorted_variable_codebook_E_dp_vtr" ~ "",
                              Variable == "variable_codebook_E" ~ "",
                              Variable == "variable_codebook_E_dp" ~ "",
                              Variable == "variable_codebook_E_dp_vtr" ~ "",
                              Variable == "variable_to_add_E" ~ "",
                              Variable == "variable_to_add_R" ~ "",
                              Variable == "variables_to_remove_R" ~ "",
                              Variable == "variable_codebook_R_ls" ~ "",
                              Variable == "bfi_e_mean" ~ "",
                              Variable == "bfi_c_mean" ~ "",
                              Variable == "bfi_n_mean" ~ "",
                              Variable == "bfi_a_mean" ~ "",
                              Variable == "bfi_o_mean" ~ "",
                              Variable == "exclude_bfi_completeness" ~ "",
                              Variable == "exclude_bfi_logical_scores" ~ "",
                              Variable == "exclude_iat_completeness" ~ "",
                              Variable == "exclude_iat_performance" ~ "",
                              Variable == "exclude_participant" ~ "",
                              Variable == "iat_D" ~ "",
                              Variable == "iat_SD" ~ "",
                              Variable == "iat_mean1" ~ "",
                              Variable == "iat_mean2" ~ "",
                              Variable == "unique_id" ~   "",
                              Variable == "age" ~   "",
                              Variable == "gender" ~   "",
                              Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "",
                              Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "",
                              Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "",
                              Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "",
                              Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "",
                              Variable == "bfi_e1,...,bfi_e9" ~   "",
                              Variable == "bfi_c1,...,bfi_c9" ~   "",
                              Variable == "bfi_n1,...,bfi_n9" ~   "",
                              Variable == "bfi_a1,...,bfi_a9" ~   "",
                              Variable == "bfi_o1,...,bfi_o9" ~   "",
                              TRUE ~ NA))|>
  mutate(new_changes = case_when(Variable == "data_bfi_raw" ~ "",
                                 Variable == "data_demographics_raw" ~ "",
                                 Variable == "data_iat_raw" ~ "",
                                 Variable == "data_demographics" ~ "one-row-one-participant and age is numerical",
                                 Variable == "data_iat" ~ "",
                                 Variable == "data_bfi" ~ "",
                                 Variable == "data_bfi_completeness" ~ "",
                                 Variable == "ddata_iat_completeness" ~ "",
                                 Variable == "data_bfi_logical_scores" ~ "",
                                 Variable == "data_bfi_meanscore" ~ "",
                                 Variable == "data_bfi_rev" ~ "",
                                 Variable == "data_bfi_rev_without_onrc" ~ "",
                                 Variable == "data_bfi_rev_without_onrc_ex_compl" ~ "",
                                 Variable == "data_demographics_raw" ~ "",
                                 Variable == "data_iat_D" ~ "",
                                 Variable == "data_iat_mean1" ~ "",
                                 Variable == "data_iat_mean2" ~ "",
                                 Variable == "data_iat_performance" ~ "",
                                 Variable == "data_iat_SD" ~ "",
                                 Variable == "data_processed" ~ "",
                                 Variable == "data_processed_temp" ~ "",
                                 Variable == "maxscore_bfi_e" ~ "",
                                 Variable == "maxscore_bfi_c" ~ "",
                                 Variable == "maxscore_bfi_n" ~ "",
                                 Variable == "maxscore_bfi_a" ~ "",
                                 Variable == "maxscore_bfi_o" ~ "",
                                 Variable == "minscore_bfi_e" ~ "",
                                 Variable == "minscore_bfi_c" ~ "",
                                 Variable == "minscore_bfi_n" ~ "",
                                 Variable == "minscore_bfi_a" ~ "",
                                 Variable == "minscore_bfi_o" ~ "",
                                 Variable == "cor_bfi_e" ~ "",
                                 Variable == "cor_bfi_c" ~ "",
                                 Variable == "cor_bfi_n" ~ "",
                                 Variable == "cor_bfi_a" ~ "",
                                 Variable == "cor_bfi_o" ~ "",
                                 Variable == "negative_values_e_exist" ~ "",
                                 Variable == "negative_values_c_exist" ~ "",
                                 Variable == "negative_values_n_exist" ~ "",
                                 Variable == "negative_values_a_exist" ~ "",
                                 Variable == "negative_values_o_exist" ~ "",
                                 Variable == "result_range_e" ~ "",
                                 Variable == "result_range_c" ~ "",
                                 Variable == "result_range_n" ~ "",
                                 Variable == "result_range_a" ~ "",
                                 Variable == "result_range_o" ~ "",
                                 Variable == "result_bfi_compl" ~ "",
                                 Variable == "result_bfi_logical_scores" ~ "",
                                 Variable == "result_iat_compl" ~ "",
                                 Variable == "result_iat_perf" ~ "",
                                 Variable == "result_master_exclusion" ~ "",
                                 Variable == "codebook_E" ~ "",
                                 Variable == "codebook_R" ~ "",
                                 Variable == "sorted_variable_codebook_E_dp_vtr" ~ "",
                                 Variable == "variable_codebook_E" ~ "",
                                 Variable == "variable_codebook_E_dp" ~ "",
                                 Variable == "variable_codebook_E_dp_vtr" ~ "",
                                 Variable == "variable_to_add_E" ~ "",
                                 Variable == "variable_to_add_R" ~ "",
                                 Variable == "variables_to_remove_R" ~ "",
                                 Variable == "variable_codebook_R_ls" ~ "",
                                 Variable == "bfi_e_mean" ~ "",
                                 Variable == "bfi_c_mean" ~ "",
                                 Variable == "bfi_n_mean" ~ "",
                                 Variable == "bfi_a_mean" ~ "",
                                 Variable == "bfi_o_mean" ~ "",
                                 Variable == "exclude_bfi_completeness" ~ "",
                                 Variable == "exclude_bfi_logical_scores" ~ "",
                                 Variable == "exclude_iat_completeness" ~ "",
                                 Variable == "exclude_iat_performance" ~ "",
                                 Variable == "exclude_participant" ~ "",
                                 Variable == "iat_D" ~ "",
                                 Variable == "iat_SD" ~ "",
                                 Variable == "iat_mean1" ~ "",
                                 Variable == "iat_mean2" ~ "",
                                 Variable == "unique_id" ~   "",
                                 Variable == "age" ~   "",
                                 Variable == "gender" ~   "",
                                 Variable == "bfi_e1_rev,...,bfi_e9_rev" ~   "",
                                 Variable == "bfi_c1_rev,...,bfi_c9_rev" ~   "",
                                 Variable == "bfi_n1_rev,...,bfi_n9_rev" ~   "",
                                 Variable == "bfi_a1_rev,...,bfi_a9_rev" ~   "",
                                 Variable == "bfi_o1_rev,...,bfi_o9_rev" ~   "",
                                 Variable == "bfi_e1,...,bfi_e9" ~   "",
                                 Variable == "bfi_c1,...,bfi_c9" ~   "",
                                 Variable == "bfi_n1,...,bfi_n9" ~   "",
                                 Variable == "bfi_a1,...,bfi_a9" ~   "",
                                 Variable == "bfi_o1,...,bfi_o9" ~   "",
                                 TRUE ~ NA))

# Create an Excel workbook
wb_Codebook_R <- createWorkbook()

# Add a worksheet named "Codebook" to the workbook
addWorksheet(wb_Codebook_R, "Codebook")

# Write the data frame 'codebook_R' to the "Codebook" worksheet
writeData(wb_Codebook_R, "Codebook", codebook_R)

# Adjust the column widths of the "Codebook" worksheet to fit the content
setColWidths(wb_Codebook_R, "Codebook", cols = 1:ncol(codebook_R), widths = "auto")

# Get the current working directory
script_dir <- getwd()

# Save the workbook to an Excel file in the same directory as the R script
saveWorkbook(wb_Codebook_R, file = file.path(script_dir, "R_processing_codebook.xlsx"), overwrite = TRUE)

```

# Session info

```{r}

sessionInfo()

```


