---
title: "Plot assignment"
author: "Template: Ian Hussey; content: Annika Langner"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

```

# Dependencies

```{r}

library(tidyverse)
library(ggplot2)
library(ggExtra)
library(dplyr)
library(showtext)
library(ggdist)
library(ggmagnify)


```

# Instructions

The goal of this exercise is to produce both good and bad examples of plots *and to be explicit about what makes them good or bad*. 

The data can be real or fabricated. The plots can convey realistic or silly messages - but they must convey them clearly. You can get real data from many sources. A good one is the open science framekwork (osf.io). You can also simply make up data, either by hand or using simulation functions (e.g., `rnorm`) or the many simulation packages. If simulating data, ensure that you (a) use set.seed() to make it reproudbile, and (b) save a copy of the final data that you're using to disk and then reload it in the script so that the plot is reproducible.

The goal is neither to reproduce the types of plots that you most often see in journals (bar plots, etc.) nor to use a very fancy looking plot just for the sake of it - if it is very unlikely that you'd ever be able to use the plot to convey a research finding in an article, blog, poster, tweet, infographic or otherwise, it's probably not a good choice either.

The plots must be reproducible. Provide the data as well as the code to reporduce them. The plots should also be saved as individual images (pdf or png).

Under each plot, here in the RMarkdown, briefly explain what types of analysis the plot is suitable for, what elements of the results the plot attempts to clearly convey. For the bad plot, do the opposite: emphasise what features of the results the plot obscures or makes unclear. In doing so, communicate to me that you understand what makes a good plot to convey the results of quantiative analyses to viewers.

Consider making use of the many extensions to ggplot2, e.g.:

- https://r-graph-gallery.com
- https://krzjoa.github.io/awesome-r-dataviz/#/
- ggdist https://mjskay.github.io/ggdist/
- ggrepel
- ggpubr
- see
- ggsignif
- and others: https://exts.ggplot2.tidyverse.org/gallery/


# Dataset

Since it involves a fictional dataset, I have also devised a rather unrealistic background story.
Embark on an enchanting journey to the fantastical realm of R-codeia, a region not bound by the drab limits of reality.
Once upon a time, in a land of many rainbows, leprechauns were the caretakers of these colorful wonders. Each leprechaun was part of a different group, identifiable by a unique crest color. The rainbows they tended reflected the group's crest color, adding to the diversity of this mystical landscape.

Research Objectives: Our study aims to analyze the dataset with the following goals:

To explore the relationship between the leprechauns' perceived wealth and their neuroticism scores within each group, represented by crest colors.

To investigate variations in wealth and emotional stability across the different groups.

To determine whether the group leader (indicated by an "L" in the dataset; note that the yellow group practices anarchy and thus has no leader) tends to be more financially affluent and emotionally stable than the other group members.


```{r}
set.seed(123)

data <- iris |>
  select(Sepal.Length, Sepal.Width, Species)|>
  filter(Species != "virginica") |>
  mutate(
    color = case_when(
      Species == "setosa" ~ "red",
      Species == "versicolor" ~ "blue",
      TRUE ~ NA
    ),
    neurotizismus = Sepal.Width,
    wealth = Sepal.Length
  )|>
  select(-Species,-Sepal.Length,-Sepal.Width)

data_green1 <- data.frame(
  wealth = runif(15, min = 6, max = 9),
  neurotizismus = runif(15, min = 2, max = 3),
  color = rep("green", 15)  
)

data_green2 <- data.frame(
  wealth = runif(10, min = 7, max = 7.5),
  neurotizismus = runif(10, min = 2.01, max = 2.2),
  color = rep("green", 10)  
)

data_yellow <- data.frame(
  wealth = runif(15, min = 8, max = 9),
  neurotizismus = runif(15, min = 4, max = 4.5),
  color = rep("yellow", 15)  
)
data_green<- rbind(data_green1, data_green2)
data_green_blue_red <- rbind(data_green, data)
data <- rbind(data_yellow, data_green_blue_red)

data$label <- NA
green_rows <- which(data$color == "green" & data$wealth >= 7 & data$wealth <= 8)
data$label[sample(green_rows, 1)] <- "L"

red_rows <- which(data$color == "red")
max_neurotizismus_row <- which.max(data$neurotizismus[red_rows])
data$label[red_rows[max_neurotizismus_row]] <- "L"

blue_rows <- which(data$color == "blue")
min_neurotizismus_row <- which.min(data$neurotizismus[blue_rows])
data$label[blue_rows[min_neurotizismus_row]] <- "L"


#Save data
csv_file <- "data.csv"

if (!file.exists(csv_file)) {
  write.csv(data, file = csv_file, row.names = FALSE)
} else {
  print("The file already exists.")
}

#Load data
data <- read_csv("data.csv")

```



# Good plot


```{r}
from <- c(xmin = 7, xmax = 7.5, ymin = 2, ymax = 2.2)
to <- c(xmin = 6, xmax = 7.8, ymin = 3.6, ymax = 4.32)

graph <- ggplot(data, aes(x = wealth, y = neurotizismus, color = color)) +
  geom_point(aes(shape = color)) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x) +
  scale_y_continuous(breaks = seq(0, 6, by = 0.5)) +
  scale_x_continuous(breaks = seq(0, 30, by = 0.5)) +
  scale_color_manual(values = c("blue" = "royalblue", "green" = "seagreen3", "red" = "red3", "yellow" = "goldenrod1"), 
                     labels = c("blue", "green", "red", "yellow")) +
  scale_shape_manual(values = c("blue" = 0, "green" = 16, "red" = 3, "yellow" =2), 
                     labels = c("blue", "green", "red", "yellow")) +
  geom_label(aes(label = label), show.legend = FALSE) + 
  theme_minimal() +
  labs(title = "Relationship between neuroticism and wealth", x="Wealth (in 1000 gold coins)", y="Neurotizism score")+
  theme(panel.background = element_rect(fill = "grey94"))+
  ggplot2::labs(
    caption = "Note: L stands for leader. Each group, except the yellow group, has one leader."
    )

ggmagnifyplot<-graph+ geom_magnify(from = from, to = to)+
  theme_linedraw()
plot_good_AnnikaLangner <- ggMarginal(ggmagnifyplot, type = "density", groupColour = TRUE, groupFill = TRUE, fill = "black")

plot_good_AnnikaLangner

```



- In this plot, data points are easily distinguishable through various colors and shapes
- The axes are easily readable
- The meaning of L has been explained.(Note)
- Assuming one is not colorblind, colors can be distinguished very well, and they can be easily recognized, even against the background.
- All data points are visible in the graph. The axes are chosen in a way that data points do not extend beyond the visible range.
- The density curve aligns with the scatterplot, sharing the same dimensions.
- Axes, title and the legend are readable and labeled.
- The zoomed-in rectangle through the geom_magnify function doesn't overlay on top of other data points
- The zoomed-in rectangle through the geom_magnify function has same proportions than the original triangle.
- The zoomed-in rectangle through the geom_magnify function has a slightly different background color, making it distinguishable from the rest of the plot.
- The zoomed-in rectangle through the geom_magnify function depicts a data range where there is a concentration of data points, and the rectangle helps distinguish the data more effectively. Especially where the 'L' is situated slightly on other points.
- The displayed colors match the colors intended for representation. blue=blue, green=green etc.
- The size of the data points is well chosen, preventing overlap. The points are not too large.
- The density representation on the side illustrates the distribution of values of the groups. For example, the yellow group exhibits relatively high neuroticism values.
- The scatter plot depicts the individual distribution of leprechauns. It indicates whether they are widely spread around the regression line or closely clustered. Additionally, it allows for examining the positions of specific individuals, such as leaders, within the plot.
- The regression line illustrates the relationship (not always necessarily indicating significance, but whether the slope is more positive, neutral, or negative, and the strength of the slopeâ€”whether it is shallow or steep).


# Bad plot

```{r}
from <- c(xmin = 7, xmax = 7.5, ymin = 2, ymax = 2.2)
to <- c(xmin = 6, xmax = 30, ymin = 3.73, ymax = 4.45)

graph <- ggplot(data, aes(x = wealth, y = neurotizismus, color = color)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x) +
  scale_y_continuous(breaks = seq(0, 2.5, by = 0.08),limits = c(0, 4.2)) +
  scale_x_continuous(breaks = seq(0, 100, by = 16.4)) +
  scale_color_manual(values = c("blue" = "blue1", "green" = "blue3", "red" = "red", "yellow" = "lightyellow"), 
                     labels = c("red", "XXX", "yellow", "Blue")) +
  geom_point(color = "black", size=5)+
  theme_minimal()+
  labs(x = NULL) +
  labs(title = "The following graph below illustrates a relationship.The following graph showcases regression lines and data points representing wealth, neuroticism, and colors.")+
  #theme(panel.background = element_rect(fill = "blue"))+
  coord_cartesian(xlim = c(6, 32)) +
  theme(panel.background = element_rect(fill = "gray10"))

# Create the marginal histograms
ggmagnifyplot<-graph+ geom_magnify(from = from, to = to)+theme_linedraw()
plot_bad_AnnikaLangner <- ggMarginal(ggmagnifyplot, type = "density", groupColour = TRUE, groupFill = TRUE, fill = "black")

plot_bad_AnnikaLangner

```


- All data points are black, and the data points are also very wide. It is difficult to distinguish between the data points and identify which data points belong to which color
- The title is too long and not precise
- The positions of the leaders cannot be identified.
- color: The colors of the regression lines are not well chosen, making the legend very difficult to read. Green color is represented in blue, yellow color in red, and red color in blue, and for the blue color, only XXX is displayed.
- color: Moreover, the color lightyellow was used, which is indistinguishable from the white background.
- color: The two chosen shades of blue are difficult to distinguish. 

- geom_magnify: The background of the zoomed-in rectangle through the geom_magnify function is dark, making it difficult to discern the data points.
- geom_magnify: The zoomed-in rectangle through the geom_magnify function overlays on top of other data points, thereby obscuring them.
- geom_magnify: The zoomed-in rectangle through the geom_magnify function has different proportions than the original triangle, resulting in vertical distortion of the point representation.

- axes: The y-axis ranges only from 0 to 2.5 and displays too many numbers, making it difficult to discern individual values.There are no values on half of the y-axis, and on the other half, the values cannot be read.
- axes: On the x-axis, there are too large steps, and the values chosen for the intervals are not suitable (16.4).
- axes: The x-axis labeling is missing.
- Not all points are represented in the graph. Adjusting Y-axis limits -scale_y_continuous(limits = c(0, 4.2)) 
- Not all points are represented in the graph. Distorting x-Axis - coord_cartesian(xlim = c(6, 32)). 
- The distortion of the x-axis does not affect the density plots, causing them to no longer align appropriately. --> Problem of ggMarginal
- The data points are not evenly distributed across the entire area, resulting in many empty spaces. This makes it challenging to read the data and unnecessarily wastes space.


# Write to disk

Write to disk as a .pdf or .png.

Name them "plot_good_[yourname]" and "plot_bad_[yourname]".

```{r}
ggsave("plot_bad_AnnikaLangner.pdf",dpi = 300,plot_bad_AnnikaLangner)
ggsave("plot_good_AnnikaLangner.pdf",dpi = 300,plot_good_AnnikaLangner)

```

# Session info

```{r}

sessionInfo()

```


